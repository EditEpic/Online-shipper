<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online-Shipper - Digital Payment Store</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the high-energy theme */
        :root {
            --neon-blue: #00FFFF;
            --dark-bg: #111827;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: #f3f4f6;
            scroll-behavior: smooth;
        }
        .neon-text-shadow {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue);
        }
        .product-card {
            transition: transform 0.2s, box-shadow 0.2s;
            background: #1f2937;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            cursor: pointer;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.2);
        }
        .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            font-weight: 800;
            font-size: 0.8rem;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            transform: rotate(5deg);
        }
        .view { display: none; }
        .view.active { display: block; }

        /* Google Pay Style simulation */
        .gpay-button {
            background-color: #4285F4; /* Google Blue */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .gpay-button:hover {
            background-color: #357ae8;
        }
        .gpay-logo {
            width: 32px;
            height: 32px;
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, runTransaction, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firebase global variables
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.isAuthReady = false;
        window.cartItems = [];
        window.APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-online-shipper';
        window.SUBTOTAL = 0; // Global variable to hold calculated subtotal
        
        setLogLevel('debug');

        // --- 1. Initialization and Authentication ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        
        onAuthStateChanged(window.auth, async (user) => {
            if (user) {
                window.userId = user.uid;
            } else {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(window.auth, __initial_auth_token);
                        window.userId = window.auth.currentUser.uid;
                    } else {
                        const anonUser = await signInAnonymously(window.auth);
                        window.userId = anonUser.user.uid;
                    }
                } catch (error) {
                    console.error("Firebase Sign-in Error:", error);
                }
            }
            window.isAuthReady = true;
            console.log("Auth Ready. User ID:", window.userId);

            if (window.userId) {
                setupCartListener();
            }
        });

        // --- 2. Cart Listener and UPI VPA Setup ---
        function setupCartListener() {
            const cartPath = `artifacts/${window.APP_ID}/users/${window.userId}/cart/items`;
            const cartDocRef = doc(window.db, cartPath);

            onSnapshot(cartDocRef, (docSnap) => {
                if (docSnap.exists() && docSnap.data().items) {
                    window.cartItems = docSnap.data().items;
                } else {
                    window.cartItems = [];
                }
                updateCartUI();
                updateCartCount();
                updatePaymentUI(); // Update checkout totals
            }, (error) => {
                console.error("Cart Listener Error:", error);
            });
        }
        
        // Expose functions to the global scope
        window.addToCart = addToCart;
        window.incrementItem = (id) => updateCartItemQuantity(id, 1);
        window.decrementItem = (id) => updateCartItemQuantity(id, -1);
        window.showView = showView;
        window.showProductDetails = showProductDetails;
        window.generateUPIPaymentLink = generateUPIPaymentLink;
        
        // --- 3. Firestore Cart Operations (Core logic for persistence) ---
        async function addToCart(product) {
            if (!window.isAuthReady || !window.userId) {
                console.error("Firebase not ready. Cannot add to cart.");
                return;
            }
            
            const cartPath = `artifacts/${window.APP_ID}/users/${window.userId}/cart/items`;
            const cartDocRef = doc(window.db, cartPath);

            try {
                await runTransaction(window.db, async (transaction) => {
                    const docSnap = await transaction.get(cartDocRef);
                    let items = docSnap.exists() && docSnap.data().items ? docSnap.data().items : [];
                    
                    const existingIndex = items.findIndex(item => item.id === product.id);

                    if (existingIndex > -1) {
                        items[existingIndex].quantity += 1;
                    } else {
                        items.push({
                            id: product.id,
                            name: product.name,
                            price: product.price,
                            image: product.image,
                            quantity: 1
                        });
                    }

                    transaction.set(cartDocRef, { items: items });
                    
                    // Show confirmation in shop/detail view
                    const button = document.getElementById(`addToCartBtn-${product.id}`) || document.getElementById('productDetailCartBtn');
                    if(button) {
                        button.textContent = 'Added! View Cart →';
                        button.classList.add('bg-green-600', 'hover:bg-green-500');
                        setTimeout(() => {
                             if(document.getElementById('shop-view').classList.contains('active') || document.getElementById('product-view').classList.contains('active')) {
                                button.textContent = 'ADD TO CART';
                                button.classList.remove('bg-green-600', 'hover:bg-green-500');
                                button.classList.add('bg-red-600', 'hover:bg-red-500');
                             }
                        }, 1500);
                    }
                });
            } catch (error) {
                console.error("Transaction failed: ", error);
            }
        }
        
        async function updateCartItemQuantity(id, delta) {
            if (!window.isAuthReady || !window.userId) return;

            const cartPath = `artifacts/${window.APP_ID}/users/${window.userId}/cart/items`;
            const cartDocRef = doc(window.db, cartPath);

            try {
                await runTransaction(window.db, async (transaction) => {
                    const docSnap = await transaction.get(cartDocRef);
                    let items = docSnap.exists() && docSnap.data().items ? docSnap.data().items : [];
                    
                    const existingIndex = items.findIndex(item => item.id === id);

                    if (existingIndex > -1) {
                        items[existingIndex].quantity += delta;
                        
                        if (items[existingIndex].quantity <= 0) {
                            items.splice(existingIndex, 1);
                        }
                    }

                    transaction.set(cartDocRef, { items: items });
                });
            } catch (error) {
                console.error("Quantity transaction failed: ", error);
            }
        }
        
        async function completeOrder() {
            if (!window.isAuthReady || !window.userId) return;
            const cartPath = `artifacts/${window.APP_ID}/users/${window.userId}/cart/items`;
            const cartDocRef = doc(window.db, cartPath);
            
            try {
                await setDoc(cartDocRef, { items: [] });
                console.log("Cart cleared after order completion.");
            } catch (error) {
                console.error("Failed to clear cart:", error);
            }
        }


        // Dummy product data (Prices in INR)
        window.PRODUCTS = [
            { id: 'rc_car_x300', name: 'QUANTUM DRIFTER X300', price: 9599.00, salePrice: 15999.00, desc: 'Next-Gen Brushless Power', image: 'https://placehold.co/600x400/000/fff?text=RC+DRIFTER+%F0%9F%9A%98', badge: 'HOT ITEM', details: 'Unleash the speed with the X300’s all-wheel drive and high-torque motor. Features 2.4GHz remote control and durable chassis built for intense drifts. Includes fast charger and extra set of tires.', stock: 5 },
            { id: 'gaming_headset_hzpro', name: 'APEX AUDIO HZ PRO', price: 6000.00, salePrice: 12000.00, desc: '7.1 Surround Sound Dominance', image: 'https://placehold.co/600x400/000/fff?text=GAMING+HEADSET+%F0%9F%8E%A7', badge: 'SAVE 50%', details: 'Experience crystal-clear positional audio with 50mm neodymium drivers. The HZ PRO features a noise-canceling mic and plush, breathable ear cups for marathon gaming sessions. USB and 3.5mm compatible.', stock: 12 },
            { id: 'smart_watch_v4', name: 'TITAN TRACKER V4', price: 11920.00, salePrice: 19999.00, desc: 'Military Grade Durability', image: 'https://placehold.co/600x400/000/fff?text=PERFORMANCE+WATCH+%E2%8F%B1', badge: 'BEST SELLER', details: 'Built to withstand extreme conditions, the V4 tracks heart rate, sleep, and 100+ sports modes. Features a ruggedized display and a battery life of up to 14 days on a single charge. Waterproof up to 50m.', stock: 3 }
        ];

        // --- 4. UI Update Functions ---
        
        function formatPrice(amount) {
            return `₹${amount.toFixed(2)}`;
        }
        
        function updateCartUI() {
            const cartContainer = document.getElementById('cartItems');
            const cartTotalElement = document.getElementById('cartTotal');
            let subtotal = 0;
            let cartHtml = '';

            if (window.cartItems.length === 0) {
                cartHtml = '<p class="text-gray-400 text-center py-8">Your cart is empty! Time to check out the amazing deals in the shop.</p>';
            } else {
                cartHtml = window.cartItems.map(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    
                    return `
                        <div class="flex items-center space-x-4 border-b border-gray-700 py-4">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md border-2 border-cyan-500/50">
                            <div class="flex-grow">
                                <p class="font-bold text-white">${item.name}</p>
                                <p class="text-sm text-gray-400">${formatPrice(item.price)} each</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="window.decrementItem('${item.id}')" class="bg-gray-700 text-white p-1 rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition">-</button>
                                <span class="font-bold w-4 text-center">${item.quantity}</span>
                                <button onclick="window.incrementItem('${item.id}')" class="bg-gray-700 text-white p-1 rounded-full w-6 h-6 flex items-center justify-center hover:bg-green-600 transition">+</button>
                            </div>
                            <div class="font-extrabold text-cyan-400 w-20 text-right">
                                ${formatPrice(itemTotal)}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            window.SUBTOTAL = subtotal; // Store global subtotal
            cartContainer.innerHTML = cartHtml;
            cartTotalElement.textContent = formatPrice(subtotal);
            
            const checkoutButton = document.getElementById('goToCheckoutButton');
            if (subtotal > 0) {
                checkoutButton.classList.remove('opacity-50', 'cursor-not-allowed');
                checkoutButton.disabled = false;
            } else {
                checkoutButton.classList.add('opacity-50', 'cursor-not-allowed');
                checkoutButton.disabled = true;
            }
        }

        function updateCartCount() {
            const totalQuantity = window.cartItems.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = `(${totalQuantity})`;
        }
        
        function updatePaymentUI() {
            const total = window.SUBTOTAL;
            document.getElementById('checkoutTotalDisplay').textContent = formatPrice(total);
            
            const paymentButton = document.getElementById('gpayPaymentButton');
            if (total > 0) {
                 paymentButton.classList.remove('opacity-50', 'cursor-not-allowed');
                 paymentButton.disabled = false;
            } else {
                paymentButton.classList.add('opacity-50', 'cursor-not-allowed');
                paymentButton.disabled = true;
            }
        }
        
        // --- 5. View Switching and Product Detail Logic ---
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
            window.scrollTo(0, 0);
            
            // Clear checkout message when navigating away
            document.getElementById('checkoutMessageBox').classList.add('hidden');
        }
        
        function showProductDetails(productId) {
            const product = window.PRODUCTS.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('productDetailImage').src = product.image;
            document.getElementById('productDetailTitle').textContent = product.name;
            document.getElementById('productDetailPrice').textContent = formatPrice(product.price);
            document.getElementById('productDetailSalePrice').innerHTML = `<span class="line-through text-gray-500 text-xl mr-3">${formatPrice(product.salePrice)}</span>`;
            document.getElementById('productDetailDescription').textContent = product.details;
            document.getElementById('productDetailStock').textContent = product.stock > 0 ? `In Stock: ${product.stock} units` : 'Out of Stock';
            
            // Setup the specific product for the cart button
            const detailBtn = document.getElementById('productDetailCartBtn');
            detailBtn.onclick = () => window.addToCart(product);
            
            // Reset button text just in case user added it from shop view
            detailBtn.textContent = 'ADD TO CART';
            detailBtn.classList.remove('bg-green-600', 'hover:bg-green-500');
            detailBtn.classList.add('bg-red-600', 'hover:bg-red-500');
            
            showView('product-view');
        }

        // --- 6. UPI/GPay Payment Simulation (NEW) ---
        function generateUPIPaymentLink() {
            const total = window.SUBTOTAL.toFixed(2);
            const VPA = 'FAMPAY.VPA@OSBANK'; // Placeholder for Fampay VPA
            const MerchantName = 'Online-Shipper-Store';
            const note = 'Order-' + new Date().getTime();

            // Construct UPI deep link structure
            const upiLink = `upi://pay?pa=${VPA}&pn=${MerchantName}&am=${total}&cu=INR&tid=${note}`;

            // Show confirmation and link in the message box
            const messageBox = document.getElementById('checkoutMessageBox');
            messageBox.innerHTML = `
                <p class="font-bold text-2xl mb-2">Initiating Payment...</p>
                <p class="text-lg">Total Payable: <span class="font-extrabold text-cyan-400">${formatPrice(total)}</span></p>
                <p class="text-sm mt-3 text-gray-300">
                    In a real app, clicking the button would open your GPay/Fampay app directly.
                </p>
                <p class="text-sm mt-1 text-gray-300">
                    Since this is a simulation, click the link below to see the UPI deep link structure:
                </p>
                <a href="${upiLink}" target="_blank" class="text-red-400 font-medium break-all mt-2 block underline">${upiLink.substring(0, 50)}...</a>

                <div class="text-center my-4">
                    <img src="https://placehold.co/150x150/000/00FF00?text=Scan+to+Pay" alt="QR Code Placeholder" class="mx-auto rounded">
                    <p class="text-xs text-gray-500 mt-1">QR Code Placeholder</p>
                </div>
            `;
            messageBox.classList.remove('hidden');
            messageBox.classList.remove('bg-green-900/40', 'text-green-200'); // Reset colors
            messageBox.classList.add('bg-cyan-900/40', 'text-cyan-200');

            // Simulate successful payment completion after a delay
            setTimeout(() => {
                // Clear cart and show final success
                window.completeOrder();
                messageBox.innerHTML = `
                    <p class="font-bold text-3xl">Payment Successful!</p>
                    <p class="text-xl mt-2">Order Confirmed for ${formatPrice(total)}.</p>
                    <p class="text-md mt-4">Thank you for your business. Redirecting to shop...</p>
                `;
                messageBox.classList.remove('bg-cyan-900/40', 'text-cyan-200');
                messageBox.classList.add('bg-green-900/40', 'text-green-200');
                
                setTimeout(() => {
                    showView('shop-view');
                }, 2000);

            }, 5000); // Simulate 5 seconds for the user to complete the payment via GPay
        }

    </script>

    <!-- Header / Urgency Banner -->
    <header class="bg-red-600 text-white text-center py-2 sticky top-0 z-50 shadow-lg">
        <p class="font-extrabold text-sm md:text-base tracking-wider">
            ⚡️ FLASH DEALS: TODAY ONLY! DIRECT PAYMENT VIA G-PAY/UPI. ⚡️
        </p>
    </header>

    <!-- Main Navigation/Logo/Search -->
    <nav class="bg-gray-900 shadow-xl border-b-4 border-cyan-500/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            
            <!-- Logo - Clickable to return to shop -->
            <a href="javascript:void(0)" onclick="showView('shop-view')" class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 neon-text-shadow" style="color: var(--neon-blue);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 12h-6l-2 3h-4l-2-3H2"/>
                    <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.56 4H7.44a2 2 0 0 0-1.99 1.11z"/>
                    <path d="M6 16h12"/>
                </svg>
                <div class="text-3xl font-extrabold tracking-tight">
                    <span class="neon-text-shadow" style="color: var(--neon-blue);">ONLINE</span> <span class="text-gray-200">SHIPPER</span>
                </div>
            </a>
            
            <!-- Search Bar -->
            <div class="w-full md:w-1/3 order-3 md:order-none">
                <input type="text" id="searchInput" placeholder="Search products, categories..." class="w-full p-2 rounded-lg bg-gray-700 text-white border border-cyan-500/50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500" />
            </div>

            <!-- Nav Links -->
            <div class="flex space-x-4 order-2 md:order-none items-center">
                <a href="javascript:void(0)" onclick="showView('shop-view')" class="text-gray-400 hover:text-cyan-400 transition duration-150 font-medium">SHOP</a>
                <a href="javascript:void(0)" onclick="showView('cart-view')" class="text-gray-400 hover:text-cyan-400 transition duration-150 font-medium flex items-center">
                    CART <span id="cartCount" class="ml-1 bg-red-600 text-xs text-white px-2 py-0.5 rounded-full font-extrabold">(0)</span>
                </a>
                <a href="javascript:void(0)" onclick="showView('checkout-view')" class="text-gray-400 hover:text-cyan-400 transition duration-150 font-medium">CHECKOUT</a>
            </div>
        </div>
    </nav>

    <!-- --- MAIN APPLICATION VIEWS CONTAINER --- -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">

        <!-- 1. SHOP VIEW (Default) -->
        <section id="shop-view" class="view active">
            <div class="text-center py-12">
                <h1 class="text-5xl md:text-6xl font-black mb-3">
                    <span class="neon-text-shadow" style="color: var(--neon-blue);">TOP TIER</span> <span class="text-white">PRODUCTS</span>
                </h1>
                <p class="text-gray-400 text-lg">Curated goods delivered fast, direct from our warehouse. Prices in Rupees (₹).</p>
            </div>
            
            <!-- Product Grid -->
            <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                
                <!-- Product 1: Drifting RC Car -->
                <div class="product-card-container">
                    <div onclick="showProductDetails('rc_car_x300')" class="product-card rounded-xl overflow-hidden shadow-2xl">
                        <div class="relative">
                            <img src="https://placehold.co/600x400/000/fff?text=RC+DRIFTER+%F0%9F%9A%98" alt="High-Performance Drifting RC Car" class="w-full h-64 object-cover">
                            <div class="badge bg-yellow-500 text-gray-900">HOT ITEM</div>
                        </div>
                        <div class="p-5 text-center flex flex-col justify-between flex-grow">
                            <div>
                                <h2 class="text-xl font-bold mb-1 text-white product-title">QUANTUM DRIFTER X300</h2>
                                <p class="text-sm text-gray-400 mb-3 product-desc">Next-Gen Brushless Power</p>
                                <div class="text-2xl font-extrabold text-cyan-400 mb-4">
                                    <span class="line-through text-gray-500 text-lg mr-2">₹15,999.00</span>
                                    ₹9,599.00
                                </div>
                            </div>
                            <button id="addToCartBtn-rc_car_x300" onclick="event.stopPropagation(); window.addToCart(window.PRODUCTS[0])" class="bg-red-600 text-white font-extrabold py-3 rounded-lg shadow-lg transition duration-300 hover:bg-red-500 w-full">
                                ADD TO CART
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product 2: High-End Gaming Headset -->
                <div class="product-card-container">
                    <div onclick="showProductDetails('gaming_headset_hzpro')" class="product-card rounded-xl overflow-hidden shadow-2xl">
                        <div class="relative">
                            <img src="https://placehold.co/600x400/000/fff?text=GAMING+HEADSET+%F0%9F%8E%A7" alt="High-End Gaming Headset" class="w-full h-64 object-cover">
                            <div class="badge bg-red-600 text-white">SAVE 50%</div>
                        </div>
                        <div class="p-5 text-center flex flex-col justify-between flex-grow">
                            <div>
                                <h2 class="text-xl font-bold mb-1 text-white product-title">APEX AUDIO HZ PRO</h2>
                                <p class="text-sm text-gray-400 mb-3 product-desc">7.1 Surround Sound Dominance</p>
                                <div class="text-2xl font-extrabold text-cyan-400 mb-4">
                                    <span class="line-through text-gray-500 text-lg mr-2">₹12,000.00</span>
                                    ₹6,000.00
                                </div>
                            </div>
                            <button id="addToCartBtn-gaming_headset_hzpro" onclick="event.stopPropagation(); window.addToCart(window.PRODUCTS[1])" class="bg-red-600 text-white font-extrabold py-3 rounded-lg shadow-lg transition duration-300 hover:bg-red-500 w-full">
                                ADD TO CART
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product 3: Smart Watch -->
                <div class="product-card-container">
                    <div onclick="showProductDetails('smart_watch_v4')" class="product-card rounded-xl overflow-hidden shadow-2xl">
                        <div class="relative">
                            <img src="https://placehold.co/600x400/000/fff?text=PERFORMANCE+WATCH+%E2%8F%B1" alt="Performance Smart Watch" class="w-full h-64 object-cover">
                            <div class="badge bg-green-500 text-gray-900">BEST SELLER</div>
                        </div>
                        <div class="p-5 text-center flex flex-col justify-between flex-grow">
                            <div>
                                <h2 class="text-xl font-bold mb-1 text-white product-title">TITAN TRACKER V4</h2>
                                <p class="text-sm text-gray-400 mb-3 product-desc">Military Grade Durability</p>
                                <div class="text-2xl font-extrabold text-cyan-400 mb-4">
                                    <span class="line-through text-gray-500 text-lg mr-2">₹19,999.00</span>
                                    ₹11,920.00
                                </div>
                            </div>
                            <button id="addToCartBtn-smart_watch_v4" onclick="event.stopPropagation(); window.addToCart(window.PRODUCTS[2])" class="w-full bg-red-600 text-white font-extrabold py-3 rounded-lg shadow-lg transition duration-300 hover:bg-red-500">
                                ADD TO CART
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. PRODUCT DETAIL VIEW -->
        <section id="product-view" class="view min-h-screen py-12">
            <button onclick="showView('shop-view')" class="text-cyan-400 hover:text-cyan-300 font-bold mb-8 flex items-center">&larr; Back to Shop</button>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 bg-gray-800 p-8 rounded-xl shadow-2xl border-2 border-cyan-500/50">
                <!-- Image Section -->
                <div class="lg:sticky top-20 h-fit">
                    <img id="productDetailImage" src="" alt="Product Detail Image" class="w-full rounded-lg object-cover shadow-xl border border-gray-700">
                </div>

                <!-- Details Section -->
                <div>
                    <h1 id="productDetailTitle" class="text-4xl md:text-5xl font-extrabold text-white mb-3"></h1>
                    <div class="flex items-baseline mb-6">
                        <p id="productDetailPrice" class="text-4xl font-black text-cyan-400 mr-4"></p>
                        <p id="productDetailSalePrice" class="text-xl text-gray-500 line-through"></p>
                    </div>

                    <p id="productDetailStock" class="text-green-400 font-semibold mb-6"></p>

                    <h2 class="text-2xl font-bold text-gray-300 mb-3">Product Description</h2>
                    <p id="productDetailDescription" class="text-gray-400 leading-relaxed mb-8"></p>

                    <button id="productDetailCartBtn" class="w-full bg-red-600 text-white font-extrabold py-4 rounded-lg shadow-xl transition duration-300 hover:bg-red-500 text-xl">
                        ADD TO CART
                    </button>
                </div>
            </div>
        </section>

        <!-- 3. CART VIEW -->
        <section id="cart-view" class="view min-h-screen">
            <div class="py-12">
                <h1 class="text-5xl font-black mb-8 text-center">
                    <span class="neon-text-shadow" style="color: var(--neon-blue);">SHOPPING</span> CART
                </h1>
                
                <div class="max-w-3xl mx-auto bg-gray-800 p-6 rounded-xl shadow-2xl border-2 border-cyan-500/50">
                    <!-- Cart Item List Container -->
                    <div id="cartItems" class="divide-y divide-gray-700">
                        <p class="text-gray-400 text-center py-8">Loading cart...</p>
                    </div>

                    <!-- Subtotal and Checkout -->
                    <div class="pt-6 mt-6 border-t border-gray-700">
                        <div class="flex justify-between items-center text-2xl font-bold mb-4">
                            <span class="text-white">Subtotal:</span>
                            <span id="cartTotal" class="text-cyan-400">₹0.00</span>
                        </div>
                        
                        <button id="goToCheckoutButton" onclick="showView('checkout-view')" class="w-full bg-cyan-600 text-white font-extrabold py-3 rounded-lg shadow-lg transition duration-300 hover:bg-cyan-500 opacity-50 cursor-not-allowed" disabled>
                            PROCEED TO DIGITAL CHECKOUT &rarr;
                        </button>
                        <button onclick="showView('shop-view')" class="w-full mt-3 bg-gray-700 text-gray-300 font-bold py-3 rounded-lg transition duration-300 hover:bg-gray-600">
                            Continue Shopping
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. CHECKOUT VIEW (GPay/UPI Focused) -->
        <section id="checkout-view" class="view min-h-screen">
            <div class="text-center py-12">
                <h1 class="text-5xl font-black mb-3">
                    <span class="neon-text-shadow" style="color: var(--neon-blue);">SECURE</span> PAYMENT
                </h1>
                <p class="text-gray-400 text-lg">Pay instantly using GPay or any UPI app to finalize the order.</p>
            </div>
            <div class="max-w-xl mx-auto">
                <div class="bg-gray-800 p-8 rounded-xl shadow-2xl border-2 border-red-500/50">
                    <h2 class="text-3xl font-bold mb-6 text-center text-white">Order Summary</h2>
                    
                    <div class="flex justify-between items-center text-3xl font-extrabold mb-8 p-4 bg-gray-900 rounded-lg border border-cyan-500/50">
                        <span class="text-gray-200">Total Payable:</span>
                        <span id="checkoutTotalDisplay" class="text-red-400">₹0.00</span>
                    </div>

                    <p class="text-gray-400 text-center mb-6">
                        Payment will be directed to: <span class="font-bold text-white">FAMPAY.VPA@OSBANK</span>
                    </p>
                    
                    <button id="gpayPaymentButton" onclick="generateUPIPaymentLink()" class="w-full gpay-button py-4 rounded-lg shadow-lg transition duration-300 opacity-50 cursor-not-allowed" disabled>
                         <!-- Custom GPay/UPI Button Look -->
                         <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Google_Pay_Logo.svg/2560px-Google_Pay_Logo.svg.png" alt="Google Pay" class="gpay-logo h-8 w-auto">
                         PAY WITH G-PAY/UPI
                    </button>
                    
                    <!-- Submission Message Container -->
                    <div id="checkoutMessageBox" class="hidden mt-6 p-4 rounded-lg">
                        <!-- Message will appear here: UPI Link generation, processing, and success -->
                    </div>

                    <button onclick="showView('cart-view')" class="w-full mt-3 bg-gray-700 text-gray-300 font-bold py-3 rounded-lg transition duration-300 hover:bg-gray-600">
                        &larr; Review Cart
                    </button>
                </div>
            </div>
        </section>
        
    </div>
    <!-- --- END MAIN APPLICATION VIEWS CONTAINER --- -->

    <!-- Footer -->
    <footer id="footer" class="bg-gray-900 border-t border-cyan-500/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
            <p class="text-gray-500 text-sm">
                &copy; 2024 Online-Shipper. All rights reserved. | <span class="neon-text-shadow" style="color: var(--neon-blue);">Digital Payments Enabled.</span>
            </p>
            <p class="text-xs text-gray-600 mt-2">
                User ID (for debug): <span id="displayUserId">...</span>
            </p>
        </div>
    </footer>

    <!-- JavaScript for DOM Manipulation and SPA Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const initializeApp = () => {
                document.getElementById('displayUserId').textContent = window.userId || 'Not signed in';
                window.showView('shop-view');
                // Initial updates are called inside the onSnapshot listener, but calling one more here ensures immediate UI setup
                window.updateCartUI(); 
            };
            
            // Wait for Firebase to be ready
            const checkAuthInterval = setInterval(() => {
                if (window.isAuthReady) {
                    clearInterval(checkAuthInterval);
                    initializeApp();
                }
            }, 100);

            // --- Search/Filtering Logic (unchanged) ---
            const searchInput = document.getElementById('searchInput');
            const productGrid = document.getElementById('productGrid');
            const products = productGrid.querySelectorAll('.product-card-container');

            searchInput.addEventListener('keyup', () => {
                const query = searchInput.value.toLowerCase();

                products.forEach(productContainer => {
                    const productText = productContainer.textContent.toLowerCase();
                    
                    if (productText.includes(query)) {
                        productContainer.style.display = 'block';
                    } else {
                        productContainer.style.display = 'none';
                    }
                });
            });
            
        });
    </script>

</body>
</html>
